"use strict";function _defineProperty(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function Common(){this.init()}function CourseDetail(){this.init()}function VideoPlaying(){this.init()}var _CourseDetail$prototy;Common.prototype={constructor:Common,init:function(){this.renderDOM(),this.bindEvents()},renderDOM:function(){if(!window.localStorage)return alert("您的浏览器不支持localstorage，请升级浏览器！"),!1;var t=JSON.parse(localStorage.getItem("userInfo"));$(".h-username").text(t.name),t.logo?$(".h-avatar").prop("src",t.logo):$(".h-avatar").prop("src","${base}/assets/images/avatar.png")},bindEvents:function(){this.logout()},logout:function(){$(".logout").click(function(){window.location.href=baseUrl+"/logout",localStorage.clear()})}};var common=new Common;$(function(){$("#loadingWrapper").show(),$.ajax({type:"POST",url:baseUrl+"/admin/mycourses/list",dataType:"json",success:function(t){var e=t.data;if(0==t.data.length)return $(".h-empty").show(),$("#loadingWrapper").hide(),!1;for(var a,i=0;i<e.length;i++){var n,o,s=e[i],r=s.studiedItem/s.totalItem,l=Math.floor(100*r)+"%";o="1"==r?"已结课":0==r?"开始学习":"继续学习",n=1==s.type?"blueBg":"orangeBg",a+='\n                    <li class=\'oneItem\'>\n                        <div class="avatorMsg">\n                            <img src="'+s.imgCoverUrl+'" alt="头像">\n                            <span class=\'h-className\'>'+s.className+'</span>\n                            <i class="h-status '+n+'"></i>\n                        </div>\n                        <div class="courseMsg">\n                            <div class=\'courseTime\'>\n                                有效期截止至 <span>'+s.validityDate+'</span>\n                            </div>\n                            <div class="progressBar">\n                                <span class=\'h-progress normalProgress\' style="width:'+l+"\"></span>\n                            </div>\n                            <div class='studyProgress '>\n                                <div class=\"h-left fl\">\n                                    <i class='iconfont icon-wancheng'></i>\n                                    <span>已学"+s.studiedItem+"次课</span>\n                                </div>\n                                <div class=\"h-right fr\">\n                                    <i class='iconfont icon-shijian'></i>\n                                    <span class='fr'>共"+s.totalItem+'次课</span>\n                                </div>\n                            </div>\n                            <button class="btnWithRedFont" data-classId="'+s.id+'" data-classType="'+s.type+'">'+o+"</button>\n                        </div>\n                    </li>\n                    "}$("#CourseList").html(a),$("#loadingWrapper").hide()},error:function(){alert("获取列表数据失败")}}),$("#CourseList").on("click",".btnWithRedFont",function(){var t=$(this).attr("data-classId"),e=$(this).attr("data-classType");localStorage.setItem("courseId",t),localStorage.setItem("ClassType",e),window.location.href=baseUrl+"/admin/mycourses/toInfo ?id="+t})}),CourseDetail.prototype=(_CourseDetail$prototy={constructor:CourseDetail,init:function(){this.renderDOM(),this.bindEvents()},publicProps:{ClassType:""}},_defineProperty(_CourseDetail$prototy,"publicProps",{wareItemId:""}),_defineProperty(_CourseDetail$prototy,"renderDOM",function(){this.initData()}),_defineProperty(_CourseDetail$prototy,"bindEvents",function(){this.tabSwitch(),this.downLoadFile(),this.toWatchvideo(),this.goBackToWatch(),this.intoBroadcast(),this.turnToWatch()}),_defineProperty(_CourseDetail$prototy,"tabSwitch",function(){$(".tabs").on("click","li",function(){var t=$(this).index();$(this).siblings("li").removeClass("activeTab"),$(this).addClass("activeTab"),$(".tabPanes").children("li").addClass("hide"),$(".tabPanes").children("li").eq(t).removeClass()})}),_defineProperty(_CourseDetail$prototy,"initData",function(){var t=this,e=localStorage.getItem("courseId"),a=localStorage.getItem("ClassType");this.publicProps.ClassType=a,$.get(baseUrl+"/admin/mycourses/info",{id:e},function(e){if(1==e.status){var a,i=e.data;$(".h-imgCover").prop("src",i.imgCoverUrl),$(".courseDetailTitle").text(i.className),$(".h-classCode").text("班级编码："+i.classCode),$(".h-classTeacher").text("授课教师："+i.nickName),$(".h-courseTime").text("上课时间："+i.beginDate+" "+i.endDate),$(".h-endTime").text("有效期截止至："+i.validityDate),$(".h-studiedItem").text("已学"+i.studiedItem+"次课"),$(".h-totalItem").text("共"+i.totalItem+"次课"),localStorage.setItem("endTimeDate",i.validityDate),$(".videoTitle").text(i.className),$(".videoTime").text("直播时间："+i.beginDate),a=1==i.type?"blueBg":"orangeBg",$(".h-status").addClass(a);var n,o=i.studiedItem/i.totalItem,s=Math.floor(100*o)+"%";n="\n                    <span class='h-progress "+("1"==o?"grayProgress":"normalProgress")+"' style='width:"+s+"'></span>\n                ",$(".progressBar").html(n);var r="\n                    <li>班级编码：<span>"+i.classCode+"</span></li>\n                    <li>授课教师：<span>"+i.nickName+"</span></li>\n                    <li>课次：<span>"+i.totalItem+"</span></li>\n                    <li>上课时间：<span>"+i.beginDate+"-"+i.endDate+"</span></li>\n                    <li>有效期截止至：<span>"+i.validityDate+"</span></li>\n                ";$(".h-detailList").html(r),$(".h-applyCrowd").html(t.newLine(i.applyCrowd)),$(".h-description").html(t.newLine(i.objective)),$(".h-objective").html(t.newLine(i.description)),$(".h-teacherName").find("span").html(t.newLine(i.teacher.name)),$(".h-school").find("span").html(t.newLine(i.teacher.academies)),$(".h-awards").html(t.newLine(i.teacher.awards)),$(".h-breifIntro").html(t.newLine(i.teacher.summary)),$(".h-detailedIntro").html(t.newLine(i.teacher.details))}else alert("获取课程基本数据失败")}),$.get(baseUrl+"/admin/mycourses/timetable",{id:e},function(t){if(1==t.status){var e=t.data,i="";$.each(e,function(t,e){var n,o,s=e.startTime.toString(),r=s.slice(-4,-2),l=s.slice(-2);1==a?(o="学习",n=0==e.isStart?"btnWithGrayFont":"btnWithRedFont h-toWatchVideo"):0==e.isStart?(o="未开始",n="btnWithGrayFont"):3==e.status?0==e.hasSyncCourseware?(n="btnWithGrayFont",o="直播已结束"):(n="btnWithRedFont h-backToWatch",o="回放"):(o="进入直播",n="btnWithRedFont h-intoBroadcast"),i+="\n                        <li>\n                            <div class='fl courseInd'>"+(t+1)+"</div>\n                            <span class='fl courseName'>"+e.name+"</span>\n                            <span class='fl courseTime'>上课时间："+e.startDate+" "+r+":"+l+'</span>\n                            <div class="startStudy fl">\n                                <button class=\''+n+"' data-id=\""+e.id+'" data-videoKey="'+e.videoKey+'" data-roomId="'+e.roomId+'">'+o+"</button>\n                            </div>\n                        </li>\n                    "}),$(".h-scheduleList").html(i)}else alert("获取课程表数据失败")}),$.get(baseUrl+"/admin/mycourses/datum",{id:e},function(t){if(1==t.status){var e=t.data,a="";$.each(e,function(t,e){a+="\n                        <li>\n                            <div class='fl courseInd'>"+(t+1)+"</div>\n                            <span class='fl courseName fileName'>"+e.fileName+'</span>\n                            <div class="startStudy fr">\n                                <button class=\'btnWithRedFont h-downLoad\' data-ext="'+e.ext+'" data-fileFullPath="'+e.fileFullPath+'" data-fileName="'+e.fileName+'">下载</button>\n                            </div>\n                        </li>\n                    '}),$(".h-courseData").html(a)}else alert("获取课程资料数据失败")})}),_defineProperty(_CourseDetail$prototy,"downLoadFile",function(){$(".h-courseData").on("click","button.h-downLoad",function(){var t=$(this),e=t.attr("data-ext"),a=t.attr("data-fileFullPath"),i=t.attr("data-fileName");window.open(baseUrl+"/admin/mycourses/toFileUrl?ext="+e+"&fileFullPath="+a+"&fileName="+i)})}),_defineProperty(_CourseDetail$prototy,"toWatchvideo",function(){$(".h-scheduleList").on("click","button.h-toWatchVideo",function(){var t=$(this),e=t.attr("data-id"),a=t.attr("data-videoKey");window.location.href=baseUrl+"/admin/mycourses/toLearning?id="+e+"&videoKey="+a,localStorage.setItem("currentVideoKey",a),localStorage.setItem("currentVideoId",e)})}),_defineProperty(_CourseDetail$prototy,"goBackToWatch",function(){var t=this;$(".h-scheduleList").on("click","button.h-backToWatch",function(){var e=$(this),a=e.attr("data-roomId");t.publicProps.wareItemId=e.attr("data-id"),$.get(baseUrl+"/admin/mycourses/courseware",{roomId:a},function(t){var e="";$.each(t.data,function(t,a){e+="\n                        <li class='h-turnToWatch' data-wareId=\""+a.wareId+'" data-id="'+a.id+'">\n                            <i>'+(t+1)+'</i>\n                            <a href="javascript:;">'+a.subject+"</a>\n                        </li>\n                    "}),$(".classList").html(e),$("#myModal").fadeIn()})}),$(".h-close").click(function(){$("#myModal").fadeOut("slow")}),$("#myModal").click(function(){$("#myModal").fadeOut("slow")}),$("#VideoList").click(function(t){t.stopPropagation()})}),_defineProperty(_CourseDetail$prototy,"intoBroadcast",function(){var t=this;$(".h-scheduleList").on("click","button.h-intoBroadcast",function(){var e=$(this),a=e.attr("data-roomId"),i=e.attr("data-id"),n=window.open(baseUrl+"/admin/mycourses/toDirect?roomId="+a+"&currentVideoId="+i);t.refreshPage(n)})}),_defineProperty(_CourseDetail$prototy,"turnToWatch",function(){var t=this;$(".classList").on("click","li",function(){var e=$(this).attr("data-wareId"),a=$(this).attr("data-id"),i=t.publicProps.wareItemId,n=window.open(baseUrl+"/admin/mycourses/toCourseware?wareId="+e+"&currentVideoId="+a+"&itemId="+i);t.refreshPage(n)})}),_defineProperty(_CourseDetail$prototy,"newLine",function(t){return t?t.replace(/\n/g,"<br/>"):"暂无"}),_defineProperty(_CourseDetail$prototy,"refreshPage",function(t){var e=setInterval(function(){t.closed&&(clearInterval(e),window.location.reload())},1e3)}),_CourseDetail$prototy);var courseDetail=new CourseDetail;$(function(){$(".doLogin").on("click",function(){var t=$("input.username").val(),e=$("input.password").val();t&&e?$.ajax({type:"POST",url:baseUrl+"/login",data:{username:t,password:e},dataType:"json",beforeSend:function(){$(".doLogin").text("登录中...").attr("disabled",!0)},success:function(t){if(1==t.status){var e=baseUrl+t.data.toMyCourse;window.location.href=e,localStorage.setItem("userInfo",JSON.stringify(t.data))}else $(".h-tip").show().text(t.message),setTimeout(function(){$(".h-tip").fadeOut()},4e3);$(".doLogin").text("登录").attr("disabled",!1)},error:function(){alert("登陆失败")}}):($(".h-tip").show().text("请输入用户名或者密码"),setTimeout(function(){$(".h-tip").fadeOut()},4e3))})});var _hmt=_hmt||[];!function(){var t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?cb9f4388fa0515524dbe1901f64cb30a";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}(),VideoPlaying.prototype={constructor:VideoPlaying,init:function(){this.renderDOM(),this.bindEvents()},renderDOM:function(){var t=localStorage.getItem("currentVideoKey");this.initVideoJs(t);var e=localStorage.getItem("courseId");$.get(baseUrl+"/admin/mycourses/timetable",{id:e},function(e){var a="";$.each(e.data,function(t,e){var i;i=0==e.isStart?"videoBtnGrayBg":"videoBtnOrangeBg",a+="\n                    <li>\n                        <span class='fl h-orderNumber'>"+(t+1)+"</span>\n                        <div class='courseName fl'>\n                            <h6>"+e.name+"</h6>\n                            <span>上课时间："+e.startTimeStr+'</span>\n                        </div>\n                        <div class="h-toStudy fr">\n                            <button class="'+i+'" data-id="'+e.id+'" data-videoKey="'+e.videoKey+'" data-duration="'+e.durationSec+'">学习</button>\n                        </div>\n                    </li>\n                '}),$(".h-videos").html(a),$(".h-totalTimes").text(e.data.length>0?e.data.length:"0"),$(".h-lastTimePoint").text(localStorage.getItem("endTimeDate")),$(".h-videos").find('button[data-videokey="'+t+'"]').parents("li").addClass("videoListBg")})},bindEvents:function(){this.changeVideo()},initVideoJs:function(t){if(!t)return $(".vjs-big-play-button").css("display","none!important"),alert("视频暂未上传，请联系课程老师！"),!1;$("#VideoMP4").attr("src",baseUrl+"/admin/mycourses/toVideoUrl?videoKey="+t);videojs("MyVideo");videojs("MyVideo").ready(function(){var t=this,e=[],a=!1;t.play();var i;t.on("durationchange",function(){i=t.duration()}),t.on("timeupdate",function(){var n=t.currentTime();if(i&&n/i>=.8){var o=localStorage.getItem("currentVideoId");$.each(e,function(t,e){if(e==o)return!1});var s={};s.classId=localStorage.getItem("courseId"),s.itemId=o,a||$.post(baseUrl+"/admin/mycourses/leaningProcess",s,function(){a=!0}),e.push(s.itemId)}})}),videojs("MyVideo",{autoplay:!0,bigPlayButton:!0,textTrackDisplay:!1,posterImage:!1,errorDisplay:!1,control:{captionsButton:!1,chaptersButton:!1,liveDisplay:!1,playbackRateMenuButton:!1,subtitlesButton:!1}},function(){this.on("ended",function(){this.pause()})})},changeVideo:function(){$(".h-videos").on("click","button.videoBtnOrangeBg",function(){var t=$(this),e=t.attr("data-videoKey");t.parents("li").addClass("videoListBg").siblings().removeClass("videoListBg"),localStorage.setItem("currentVideoId",t.attr("data-id"));var a=videojs("MyVideo");a.src({type:"video/mp4",src:baseUrl+"/admin/mycourses/toVideoUrl?videoKey="+e}),a.load(),a.play(),e||alert("视频暂未上传，请联系课程老师！")})}};var videoPlaying=new VideoPlaying;